{
  "name": "timtam-workspace",
  "private": true,
  "version": "0.0.0",
  "license": "UNLICENSED",
  "packageManager": "pnpm@10.28.1+sha512.7d7dbbca9e99447b7c3bf7a73286afaaf6be99251eb9498baefa7d406892f67b879adb3a1d7e687fc4ccc1a388c7175fbaae567a26ab44d1067b54fcb0d6a316",
  "scripts": {
    "cdk": "pnpm --filter timtam-infra cdk",
    "cdk:synth": "pnpm --filter timtam-infra cdk synth --profile admin",
    "cdk:deploy": "pnpm --filter timtam-infra cdk deploy --profile admin --require-approval never",
    "cdk:destroy": "pnpm --filter timtam-infra cdk destroy --profile admin",
    "cdk:diff": "pnpm --filter timtam-infra cdk diff --profile admin",
    "cdk:bootstrap": "pnpm --filter timtam-infra cdk bootstrap --profile admin",
    "cdk:info": "aws cloudfront list-distributions --profile admin --query 'DistributionList.Items[0].[DomainName,Id,Status]' --output table",
    "infra:synth-deploy": "pnpm --filter timtam-infra run synth-deploy",
    "sso:admin": "pnpm --filter timtam-infra run sso:admin",
    "sync-schema": "bash scripts/sync-localstack-schema.sh",
    "local:setup": "bash scripts/setup-localstack.sh",
    "local:reset": "docker-compose down && docker-compose up -d && pnpm run sync-schema",
    "infra:close": "pnpm run infra:close:lambda && pnpm run infra:close:ecs && pnpm run infra:close:cloudfront",
    "infra:close:lambda": "aws lambda list-functions --query \"Functions[?starts_with(FunctionName, 'TimtamInfraStack-')].FunctionName\" --output text --profile admin | tr '\\t' '\\n' | xargs -I {} aws lambda put-function-concurrency --function-name {} --profile admin --reserved-concurrent-executions 0 > /dev/null",
    "infra:close:ecs": "bash -c 'CLUSTER=$(aws cloudformation describe-stack-resources --stack-name TimtamInfraStack --profile admin --query \"StackResources[?ResourceType==\\`AWS::ECS::Cluster\\`].PhysicalResourceId\" --output text) && SERVICE=$(aws ecs list-services --cluster \"$CLUSTER\" --profile admin --query \"serviceArns[0]\" --output text | awk -F/ \"{print \\$NF}\") && aws ecs update-service --cluster \"$CLUSTER\" --service \"$SERVICE\" --desired-count 0 --profile admin > /dev/null'",
    "infra:close:cloudfront": "bash -c 'DIST_ID=$(aws cloudfront list-distributions --profile admin --query \"DistributionList.Items[0].Id\" --output text) && CONFIG_JSON=$(aws cloudfront get-distribution-config --id \"$DIST_ID\" --profile admin) && ETAG=$(echo \"$CONFIG_JSON\" | jq -r \".ETag\") && NEW_CONFIG=$(echo \"$CONFIG_JSON\" | jq \".DistributionConfig.Enabled = false | .DistributionConfig\") && aws cloudfront update-distribution --id \"$DIST_ID\" --if-match \"$ETAG\" --distribution-config \"$NEW_CONFIG\" --profile admin > /dev/null'",
    "infra:open": "pnpm run infra:open:lambda && pnpm run infra:open:ecs && pnpm run infra:open:cloudfront",
    "infra:open:lambda": "aws lambda list-functions --query \"Functions[?starts_with(FunctionName, 'TimtamInfraStack-')].FunctionName\" --output text --profile admin | tr '\\t' '\\n' | xargs -I {} aws lambda delete-function-concurrency --function-name {} --profile admin > /dev/null",
    "infra:open:ecs": "bash -c 'CLUSTER=$(aws cloudformation describe-stack-resources --stack-name TimtamInfraStack --profile admin --query \"StackResources[?ResourceType==\\`AWS::ECS::Cluster\\`].PhysicalResourceId\" --output text) && SERVICE=$(aws ecs list-services --cluster \"$CLUSTER\" --profile admin --query \"serviceArns[0]\" --output text | awk -F/ \"{print \\$NF}\") && aws ecs update-service --cluster \"$CLUSTER\" --service \"$SERVICE\" --desired-count 1 --profile admin > /dev/null'",
    "infra:open:cloudfront": "bash -c 'DIST_ID=$(aws cloudfront list-distributions --profile admin --query \"DistributionList.Items[0].Id\" --output text) && CONFIG_JSON=$(aws cloudfront get-distribution-config --id \"$DIST_ID\" --profile admin) && ETAG=$(echo \"$CONFIG_JSON\" | jq -r \".ETag\") && NEW_CONFIG=$(echo \"$CONFIG_JSON\" | jq \".DistributionConfig.Enabled = true | .DistributionConfig\") && aws cloudfront update-distribution --id \"$DIST_ID\" --if-match \"$ETAG\" --distribution-config \"$NEW_CONFIG\" --profile admin > /dev/null'",
    "orchestrator:build": "pnpm --filter orchestrator build",
    "facilitator:build": "AWS_PROFILE=admin ./scripts/build-facilitator.sh",
    "facilitator:deploy": "AWS_PROFILE=admin ./scripts/deploy-facilitator.sh",
    "e2e:test": "cd e2e && pnpm test",
    "e2e:test:ci": "cd e2e && pnpm run test:ci",
    "e2e:test:headed": "cd e2e && pnpm run test:headed",
    "e2e:test:ui": "cd e2e && pnpm run test:ui",
    "e2e:test:local": "cd e2e && pnpm run test:local",
    "e2e:test:local:headed": "cd e2e && pnpm run test:local:headed",
    "deploy:web-assets": "pnpm run facilitator:build && pnpm run facilitator:deploy",
    "deploy:all": "pnpm run cdk:deploy && pnpm run deploy:web-assets && uv run invoke seed-default-config-aws",
    "test": "pnpm --filter orchestrator test",
    "test:watch": "pnpm --filter orchestrator test:watch",
    "test:ui": "pnpm --filter orchestrator test:ui"
  }
}
